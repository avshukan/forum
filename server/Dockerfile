FROM node:18

# RUN npm install npm@latest -g

ARG NODE_ENV
ENV NODE_ENV $NODE_ENV
ARG POSTGRES_HOSTNAME
ENV POSTGRES_HOSTNAME $POSTGRES_HOSTNAME
ARG POSTGRES_DATABASE
ENV POSTGRES_DATABASE $POSTGRES_DATABASE
ARG POSTGRES_USERNAME
ENV POSTGRES_USERNAME $POSTGRES_USERNAME
ARG POSTGRES_PASSWORD
ENV POSTGRES_PASSWORD $POSTGRES_PASSWORD
ARG PORT
ENV PORT $PORT
ARG FRONTEND_ORIGIN
ENV FRONTEND_ORIGIN $FRONTEND_ORIGIN
ARG JWT_KEY
ENV JWT_KEY $JWT_KEY
ARG GOOGLE_ID
ENV GOOGLE_ID $GOOGLE_ID
ARG GOOGLE_SECRET
ENV GOOGLE_SECRET $GOOGLE_SECRET
ARG GITHUB_ID
ENV GITHUB_ID $GITHUB_ID
ARG GITHUB_SECRET
ENV GITHUB_SECRET $GITHUB_SECRET

EXPOSE $PORT

WORKDIR /usr/src/server

COPY . /usr/src/server

RUN npm install --verbose

# CMD [ "make", "migrate"]

ENTRYPOINT ["make", "start"]

# ENTRYPOINT ["npm", "run", "start"]
