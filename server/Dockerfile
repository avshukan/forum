FROM node:18-alpine

ARG NODE_ENV
ENV NODE_ENV $NODE_ENV
ARG POSTGRES_HOSTNAME
ENV POSTGRES_HOSTNAME $POSTGRES_HOSTNAME
ARG POSTGRES_DATABASE
ENV POSTGRES_DATABASE $POSTGRES_DATABASE
ARG POSTGRES_USERNAME
ENV POSTGRES_USERNAME $POSTGRES_USERNAME
ARG POSTGRES_PASSWORD
ENV POSTGRES_PASSWORD $POSTGRES_PASSWORD
ARG PORT
ENV PORT $PORT
ARG CORS_HOSTNAME
ENV CORS_HOSTNAME $CORS_HOSTNAME
ARG JWT_KEY
ENV JWT_KEY $JWT_KEY

EXPOSE $PORT

WORKDIR /usr/src/server

COPY . /usr/src/server

RUN npm install npm@latest -g

RUN npm install

# CMD [ "make", "migrate"]

ENTRYPOINT ["make", "start"]
